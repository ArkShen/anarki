(test-iso "unserialize complements serialize for nil"
  ()
  (unserialize:serialize ()))

(test-iso "unserialize complements serialize for lists"
  '(1 2 3)
  (unserialize:serialize '(1 2 3)))

(test-iso "unserialize complements serialize for strings"
  "abc"
  (unserialize:serialize "abc"))

(test-iso "unserialize complements serialize for empty tables"
  (table)
  (unserialize:serialize (table)))

(test-iso "unserialize complements serialize for tables"
  (obj 1 2 3 4)
  (unserialize:serialize (obj 1 2 3 4)))

(test-iso "unserialize complements serialize for tables inside lists"
  `(1 ,(table) 2 3)
  (unserialize:serialize `(1 ,(table) 2 3)))

(test-iso "unserialize complements serialize for nested tables"
  (obj 1 (table) 2 3)
  (unserialize:serialize (obj 1 (table) 2 3)))

(mac foo (x) `(let y@ (+ ,x 1) (+ y@ ,x)))
(mac foo-bad (x) `(let y (+ ,x 1) (+ y ,x)))
(test-iso "mac gensyms don't capture variables"
  7
  (let y@ 3 (foo y@)))
(test-iso "mac without gensyms does capture variables"
  8  ; probably not what you want
  (let y 3 (foo-bad y)))
